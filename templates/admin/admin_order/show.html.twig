{% extends 'base.html.twig' %}

{% block title %}Order #{{ order.id }}
	- Details
{% endblock %}

{% block body %}
	<div class="container-fluid mt-4">
		<div class="row mb-4">
			<div class="col-md-12">
				<div class="d-flex justify-content-between align-items-center">
					<h1>
						<i class="bi bi-receipt"></i>
						Order #{{ order.id }}
					</h1>
					<a href="{{ path('app_admin_orders_index') }}" class="btn btn-outline-secondary">
						<i class="bi bi-arrow-left"></i>
						Back to Orders
					</a>
				</div>
			</div>
		</div>

		{% for label, messages in app.flashes %}
			{% for message in messages %}
				<div class="alert alert-{{ label }} alert-dismissible fade show" role="alert">
					{{ message }}
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				</div>
			{% endfor %}
		{% endfor %}

		<div
			class="row">
			{# Order Information #}
			<div
				class="col-md-8">
				{# Order Status Card #}
				<div class="card shadow-sm mb-4">
					<div class="card-header bg-primary text-white">
						<h5 class="mb-0">
							<i class="bi bi-info-circle"></i>
							Order Information
						</h5>
					</div>
					<div class="card-body">
						<div class="row">
							<div class="col-md-6">
								<table class="table table-borderless">
									<tr>
										<th width="40%">Order Number:</th>
										<td>
											<strong>#{{ order.id }}</strong>
										</td>
									</tr>
									<tr>
										<th>Status:</th>
										<td>
											{% if order.status == 'cart' %}
												<span class="badge bg-secondary">
													<i class="bi bi-cart"></i>
													Cart
												</span>
											{% elseif order.status == 'pending_confirmation' or order.status == 'pending' %}
												<span class="badge bg-warning text-dark">
													<i class="bi bi-clock-history"></i>
													Pending Confirmation
												</span>
											{% elseif order.status == 'confirmed' %}
												<span class="badge bg-info">
													<i class="bi bi-check-circle"></i>
													Confirmed
												</span>
											{% elseif order.status == 'shipped' %}
												<span class="badge bg-primary">
													<i class="bi bi-truck"></i>
													Shipped
												</span>
											{% elseif order.status == 'delivered' %}
												<span class="badge bg-success">
													<i class="bi bi-box-seam"></i>
													Delivered
												</span>
											{% elseif order.status == 'cancelled' %}
												<span class="badge bg-danger">
													<i class="bi bi-x-circle"></i>
													Cancelled
												</span>
											{% endif %}
										</td>
									</tr>
									<tr>
										<th>Created:</th>
										<td>{{ order.createdAt|date('d/m/Y H:i:s') }}</td>
									</tr>
									<tr>
										<th>Last Updated:</th>
										<td>{{ order.updatedAt|date('d/m/Y H:i:s') }}</td>
									</tr>
								</table>
							</div>
							<div class="col-md-6">
								<table class="table table-borderless">
									<tr>
										<th width="40%">Customer:</th>
										<td>
											{% if order.user %}
												<i class="bi bi-person-circle"></i>
												{{ order.user.email }}
											{% else %}
												<span class="text-muted">
													<i class="bi bi-cart"></i>
													Guest / Cart
												</span>
											{% endif %}
										</td>
									</tr>
									<tr>
										<th>Total Items:</th>
										<td>
											<span class="badge bg-light text-dark">
												{{ order.racquets.count }}
											</span>
										</td>
									</tr>
									<tr>
										<th>Total Amount:</th>
										<td>
											<strong class="text-primary" style="font-size: 1.2rem;">
												{{ order.total|number_format(2, '.', ',') }}
												€
											</strong>
										</td>
									</tr>
								</table>
							</div>
						</div>
					</div>
				</div>

				{# Order Items Card #}
				<div class="card shadow-sm mb-4">
					<div class="card-header bg-secondary text-white">
						<h5 class="mb-0">
							<i class="bi bi-box-seam"></i>
							Order Items
						</h5>
					</div>
					<div class="card-body p-0">
						<div class="table-responsive">
							<table class="table table-hover mb-0">
								<thead class="table-light">
									<tr>
										<th width="50%">Product</th>
										<th class="text-center">Quantity</th>
										<th class="text-end">Unit Price</th>
										<th class="text-end">Subtotal</th>
									</tr>
								</thead>
								<tbody>
									{% for item in order.racquets %}
										<tr>
											<td>
												<div class="d-flex align-items-center">
													{% if item.racquet.imgExtension %}
														<img src="{{ asset('img/racquet/' ~ item.racquet.id ~ '.' ~ item.racquet.imgExtension) }}" alt="{{ item.racquet.brand }} {{ item.racquet.model }}" class="me-3" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
													{% else %}
														<div class="me-3 bg-light d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; border-radius: 8px;">
															<i class="bi bi-image text-muted"></i>
														</div>
													{% endif %}
													<div>
														<strong>{{ item.racquet.brand }}</strong>
														<br>
														<small class="text-muted">{{ item.racquet.model }}</small>
													</div>
												</div>
											</td>
											<td class="text-center align-middle">
												<span class="badge bg-light text-dark">
													{{ item.quantity }}
												</span>
											</td>
											<td class="text-end align-middle">
												{{ item.racquet.price|number_format(2, '.', ',') }}
												€
											</td>
											<td class="text-end align-middle">
												<strong>{{ item.total|number_format(2, '.', ',') }}
													€</strong>
											</td>
										</tr>
									{% endfor %}
								</tbody>
								<tfoot class="table-light">
									<tr>
										<td colspan="3" class="text-end">
											<strong>Total:</strong>
										</td>
										<td class="text-end">
											<strong class="text-primary" style="font-size: 1.2rem;">
												{{ order.total|number_format(2, '.', ',') }}
												€
											</strong>
										</td>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</div>
			</div>

			{# Actions Sidebar #}
			<div
				class="col-md-4">
				{# Quick Actions #}
				{% if order.status not in ['cart', 'delivered', 'cancelled'] %}
				<div class="card shadow-sm mb-4">
					<div class="card-header bg-info text-white">
						<h5 class="mb-0">
							<i class="bi bi-lightning"></i>
							Quick Actions
						</h5>
					</div>
					{{ form_start(form) }}
					<div class="card-body">
						<div class="d-grid gap-2">
							{{ form_widget(form.confirm) }}
							{{ form_widget(form.cancel) }}
						</div>
					</div>
				</div>
				{% endif %}

				{# Order Timeline #}
				<div class="card shadow-sm">
					<div class="card-header bg-secondary text-white">
						<h5 class="mb-0">
							<i class="bi bi-clock-history"></i>
							Timeline
						</h5>
					</div>
					<div class="card-body">
						<ul class="list-unstyled">
							<li class="mb-3">
								<i class="bi bi-circle-fill text-success"></i>
								<strong>Created</strong>
								<br>
								<small class="text-muted ms-3">
									{{ order.createdAt|date('d/m/Y H:i') }}
								</small>
							</li>
							<li class="mb-3">
								<i class="bi bi-circle-fill text-primary"></i>
								<strong>Last Updated</strong>
								<br>
								<small class="text-muted ms-3">
									{{ order.updatedAt|date('d/m/Y H:i') }}
								</small>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
